# ECMH
## 1 原理分析

将哈希映射到椭圆曲线在密码学中扮演着关键角色，用于数字签名、密钥派生、随机数生成等应用中。

椭圆曲线密码学利用椭圆曲线上的点运算来实现加密和认证。椭圆曲线上的点通常由坐标表示，如 (x, y)，其中 x 和 y 是有限域上的元素。将哈希映射到椭圆曲线的过程可以简要概括如下：

1. 选择椭圆曲线： 首先，选择一个合适的椭圆曲线作为密码学基础。这个曲线需要满足一些特定的数学性质，以确保安全性和有效性。

2. 选择哈希函数： 选择一个哈希函数，通常是具有良好抗碰撞性（collision resistance）的函数。常用的哈希函数包括 SHA-256、SHA-3 等。

3. 哈希计算： 对要映射的数据进行哈希计算，得到一个哈希值。

4. 哈希映射到点： 将哈希值转换为椭圆曲线上的点。这个映射通常涉及将哈希值转换为椭圆曲线上的 x 坐标，并在曲线上求解 y 坐标。这可以通过一些特定的算法实现。

映射得到的椭圆曲线上的点可以用于各种密码学操作，如生成数字签名、派生密钥、产生随机数等。这些操作在椭圆曲线密码学中具有重要意义，因为椭圆曲线上的点运算具有难解性和计算效率的平衡，使得其适用于多种安全性需求。

## 2 代码分析
代码各部分解析如下：
- SM2_Mod函数：对输入的两个数进行模运算，处理了特殊情况。

- SM2__Mod_Decimal函数：实现了十进制数的模运算，通过二进制表示和模平方算法来计算模运算结果。

- key_gen函数：生成SM2算法的密钥对，使用随机数生成私钥，然后通过点运算生成公钥。
 
- SM2_Mulyipoint函数：实现了点的倍乘运算，通过二进制表示的倍数来进行点的累加运算。
 
- SM2_Pluspoint函数：实现了两个点的加法运算，处理了不同点相加、点与无穷远点相加等情况。
 
- Legendre函数：计算勒让德符号。

- Tonelli_Shanks函数：实现了Tonelli-Shanks算法，用于求解模p的平方根。
 
- Hash函数：通过输入的数据集合计算哈希值，使用SM3哈希函数和点运算。
## 3 结果分析
为达到相同的安全性，ECMH算法需要的密钥长度远远小于哈希求和算法，因而ECMH相较哈希求和算法更为安全。
生成公钥私钥：
![](https://img1.imgtp.com/2023/08/03/A3yVQ2j8.png)
然后生成哈希进而生成映射（在这里分别测试了单个输入和多个输入，以及和顺序的关系)：
![](https://img1.imgtp.com/2023/08/03/4mvPmRb5.png)