# 基于ARM嵌入式系统的AES实现
## 1  原理介绍
### 1.1 AES
AES（Advanced Encryption Standard）是一种分组密码算法，它使用一系列加密和置换操作对数据进行加密。AES的操作分为多轮，每轮包含不同的步骤。下面是AES加密的具体步骤：

1. 密钥扩展（Key Expansion）： 首先，根据输入的密钥，生成一系列扩展密钥，这些扩展密钥将在每轮中用于轮密钥加操作。

2. 初始轮密钥加（AddRoundKey）： 将输入数据（明文）与第一轮的扩展密钥进行异或运算。

3. 多轮加密（Rounds）： AES的加密过程包含多轮操作，每轮都包括以下四个步骤：

* 字节替代（SubBytes）： 对输入数据中的每个字节应用一个预定义的S盒，将每个字节替换成S盒中对应的值。

*  行移位（ShiftRows）： 将输入数据的每一行进行循环左移，每行的位移量逐行递增。这个步骤用于打破数据的连续性，增加加密的复杂性。

*  列混淆（MixColumns）： 在这一步，AES将每一列视为多项式，并对多项式进行乘法和加法运算。这一步骤在混淆数据的同时，增加了加密的随机性。

*  轮密钥加（AddRoundKey）： 将当前轮的扩展密钥与处理后的数据进行异或运算。这一步骤将扩展密钥混入数据中，增加了加密的复杂性。

4. 最后一轮： 最后一轮的步骤不包括列混淆（MixColumns），只包括字节替代（SubBytes）、行移位（ShiftRows）和轮密钥加（AddRoundKey）。
输出： 经过多轮的操作后，得到加密后的数据，即密文。
![](https://img1.imgtp.com/2023/08/03/9VJ8mI0o.png)
### 1.2 μC/OS- I I 
为了方便移植，结合操作系统课上学的μC/OS- I I 嵌入式操作系统，查阅相关资料，我决定在μC/OS- I I 上进行移植。

μC/OS- I I 是一种免费但性能稳定的实时操作系统，它是为嵌入式应用而设计的，它的绝大部分代码是用 C 语言编写的，CPU 硬件相关部分是用汇编语言编写的，总量约 200 行的汇编语言部分被压缩到最低限度，为的是便于移植到任何一种其它的 CPU 上。用户只要有标准的 ANSI的 C 交叉编译器，有汇编器、连接器等软件工具，就可以将 μC/OS- II嵌人到开发的产品中。它的特点是内核微小，结构清晰，具有良好的扩
展性。
## 2 代码实现
AES 的加密实现的Encrypt 汇编源程序结构如下：
```
AREA AESEncrypt, CODE, READONLY
ENTRY 
START
MOV R0，＃0；
LDR R1，＝State；
LDR R2，＝Temp；
BL Roundfun
……………… 调用轮函数
MOV PC，lr 从子程序中返回
END 程序结束
```
在上述汇编程序中，其参数的传递是通过数据栈[6]来传递的，中间加密轮函数的调用步骤如下：
①BL KeyExpansion ———进行密钥扩展；
②BL AddRoundkey ———与扩展密钥进行异或，实现子密钥加；
③用循环语句 Loop_i i＝0 to 9 ———中间循环 9 次轮变化；
S 盒变换时调用子程序 SubByte，进行字节替换；行变换时调用子程序 ShiftRow；列变换时调用子程序 MixColumn，进行列混淆；调用子程序AddRoundkey，进行密钥加；
④最后一次轮变换中，进行了 S 盒变换、行变换和子密钥加。分别调用了以下程序。
BL SubByte
BL ShiftRow
BL AddRoundkey
其中具体C语言实现可以看下一个project。
## 4 运行指导
将汇编代码加载到`os_code.c`文件中，然后再主函数进行调用即可
![](https://img1.imgtp.com/2023/08/03/fCaSAylX.png)
由于整个μC/OS- I I过大，就不上传了
## 5 输出结果
参考下一个project中的输入输出样例进行运行，得到如下结果：
![](https://img1.imgtp.com/2023/08/03/PnC12czr.png)
## 6 参考文献
[1]金丽.基于ARM嵌入式系统的AES加密算法实现[J].科技信息,2010,No.332(12):1-2.

［2］WilliamStallings.刘玉珍,王丽娜,傅建明等译.密码编码学与网络安全:原理与实践［M］.第 3 版.北京：电子工业出版社,2004

［3］Joan Daemen，Vincent Rijmen 著.谷大武，徐胜波译. 高级加密标
准（AES）算法———Rijndael 的设计［M］. 北京：清华大学出版社,2003